<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agentic Health Planner</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #00ff88;
            --primary-dark: #00cc6a;
            --bg-dark: #0a0e1a;
            --bg-card: #141824;
            --text-primary: #ffffff;
            --text-secondary: #8b92b0;
            --accent-blue: #4d7cfe;
            --accent-purple: #b84dfe;
            --border: #1f2637;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .bg-gradient {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, rgba(77, 124, 254, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 255, 136, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(184, 77, 254, 0.1) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 1;
        }

        .page {
            display: none;
            animation: fadeIn 0.6s ease-out;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-family: 'Syne', sans-serif;
            font-size: 4rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
            animation: slideDown 0.8s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.2rem;
            margin-bottom: 3rem;
            animation: slideDown 0.8s ease-out 0.2s both;
        }

        .form-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 3rem;
            margin-bottom: 2rem;
            animation: slideUp 0.6s ease-out;
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .form-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(0, 255, 136, 0.1);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-title {
            font-family: 'Syne', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 2rem;
            color: var(--primary);
        }

        .input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .input-field {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        input, select {
            background: var(--bg-dark);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: 'DM Sans', sans-serif;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(0, 255, 136, 0.1);
        }

        .button-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .option-btn {
            flex: 1;
            min-width: 150px;
            padding: 1rem 1.5rem;
            background: var(--bg-dark);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
        }

        .option-btn:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .option-btn.active {
            background: var(--primary);
            color: var(--bg-dark);
            border-color: var(--primary);
        }

        .generate-btn {
            width: 100%;
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, #00dd77 100%);
            border: none;
            border-radius: 16px;
            color: var(--bg-dark);
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Syne', sans-serif;
            margin-top: 2rem;
            position: relative;
            overflow: hidden;
        }

        .generate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0, 255, 136, 0.3);
        }

        .generate-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s ease;
        }

        .generate-btn:hover::before {
            left: 100%;
        }

        .profile-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: var(--bg-card);
            border: 2px solid var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 100;
            font-size: 1.5rem;
        }

        .profile-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.5);
        }

        .profile-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 14, 26, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .profile-modal.active {
            display: flex;
            animation: fadeIn 0.3s ease-out;
        }

        .profile-content {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 24px;
            padding: 3rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: scaleIn 0.5s ease-out;
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .progress-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            background: var(--bg-dark);
            border-radius: 12px;
            margin-bottom: 1rem;
        }

        .progress-label {
            font-weight: 600;
        }

        .progress-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
            font-family: 'Syne', sans-serif;
        }

        .close-btn {
            float: right;
            font-size: 2rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.3s ease;
        }

        .close-btn:hover {
            color: var(--primary);
        }

        .week-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .week-btn, .day-btn {
            padding: 1.5rem;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 700;
            font-size: 1.1rem;
            position: relative;
        }

        .week-btn:hover, .day-btn:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.2);
        }

        .week-btn.completed::after, .day-btn.completed::after {
            content: '‚úì';
            position: absolute;
            top: 10px;
            right: 10px;
            width: 25px;
            height: 25px;
            background: var(--primary);
            color: var(--bg-dark);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            animation: fadeIn 0.6s ease-out 0.3s both;
        }

        .tab {
            flex: 1;
            padding: 1.2rem;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 1.1rem;
            text-align: center;
        }

        .tab:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .tab.active {
            background: var(--primary);
            color: var(--bg-dark);
            border-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        .workout-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
            animation: slideUp 0.5s ease-out;
            animation-fill-mode: both;
        }

        .workout-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 255, 136, 0.15);
            border-color: var(--primary);
        }

        .exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .exercise-name {
            font-family: 'Syne', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .exercise-duration {
            background: var(--primary);
            color: var(--bg-dark);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 700;
        }

        .exercise-details {
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .timer-display {
            font-family: 'Syne', sans-serif;
            font-size: 3rem;
            font-weight: 800;
            text-align: center;
            margin: 1.5rem 0;
            color: var(--primary);
        }

        .timer-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .timer-btn {
            padding: 0.8rem 2rem;
            border: 2px solid var(--primary);
            background: transparent;
            color: var(--primary);
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'DM Sans', sans-serif;
        }

        .timer-btn:hover {
            background: var(--primary);
            color: var(--bg-dark);
        }

        .timer-btn.active {
            background: var(--primary);
            color: var(--bg-dark);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-dark);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent-blue));
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .meal-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            animation: slideUp 0.5s ease-out;
            animation-fill-mode: both;
        }

        .meal-time {
            display: inline-block;
            background: var(--accent-purple);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .meal-name {
            font-family: 'Syne', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .meal-items {
            display: grid;
            gap: 0.5rem;
        }

        .meal-item {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.5rem 0;
        }

        .meal-item::before {
            content: '‚Üí';
            color: var(--primary);
            font-weight: 700;
        }

        .nutrition-info {
            display: flex;
            gap: 2rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
        }

        .nutrition-item {
            display: flex;
            flex-direction: column;
        }

        .nutrition-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-bottom: 0.3rem;
        }

        .nutrition-value {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary);
        }

        .break-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 14, 26, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .break-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease-out;
        }

        .break-content {
            text-align: center;
            animation: scaleIn 0.5s ease-out;
        }

        .break-timer {
            font-family: 'Syne', sans-serif;
            font-size: 6rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 2rem 0;
        }

        .back-btn {
            padding: 1rem 2rem;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 2rem;
            display: inline-block;
        }

        .back-btn:hover {
            border-color: var(--primary);
            transform: translateX(-5px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
        }

        .stat-value {
            font-family: 'Syne', sans-serif;
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .complete-day-btn {
            width: 100%;
            padding: 1.2rem;
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            border: none;
            border-radius: 16px;
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Syne', sans-serif;
            margin-top: 2rem;
        }

        .complete-day-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(184, 77, 254, 0.3);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }

            .form-section {
                padding: 1.5rem;
            }

            .input-group {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .break-timer {
                font-size: 4rem;
            }

            .profile-btn {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="bg-gradient"></div>
    
    <button class="profile-btn" onclick="showProfile()" style="display: none;" id="profileBtn">üë§</button>

    <!-- User Details Page -->
    <div id="userDetailsPage" class="page active">
        <div class="container">
            <h1>Agentic Health Planner</h1>
            <p class="subtitle">Transform your fitness journey with AI-powered personalized plans</p>
            
            <div class="form-section" style="animation-delay: 0.1s">
                <h2 class="section-title">User Details</h2>
                <div class="input-group">
                    <div class="input-field">
                        <label>Age</label>
                        <input type="number" id="age" placeholder="20" min="10" max="100">
                    </div>
                    <div class="input-field">
                        <label>Weight (kg)</label>
                        <input type="number" id="weight" placeholder="100" min="30" max="200">
                    </div>
                    <div class="input-field">
                        <label>Height (cm)</label>
                        <input type="number" id="height" placeholder="188" min="100" max="250">
                    </div>
                </div>
            </div>

            <div class="form-section" style="animation-delay: 0.2s">
                <h2 class="section-title">Daily Exercise Time</h2>
                <div class="button-group" id="durationGroup">
                    <button class="option-btn" data-value="30">30 Minutes</button>
                    <button class="option-btn active" data-value="60">60 Minutes</button>
                    <button class="option-btn" data-value="90">90 Minutes</button>
                </div>
            </div>

            <div class="form-section" style="animation-delay: 0.25s">
                <h2 class="section-title">Program Duration</h2>
                <div class="button-group" id="programDurationGroup">
                    <button class="option-btn" data-value="7">1 Week</button>
                    <button class="option-btn active" data-value="30">1 Month</button>
                    <button class="option-btn" data-value="90">3 Months</button>
                    <button class="option-btn" data-value="180">6 Months</button>
                </div>
            </div>

            <div class="form-section" style="animation-delay: 0.3s">
                <h2 class="section-title">Equipment Available</h2>
                <div class="button-group" id="equipmentGroup">
                    <button class="option-btn" data-value="none">No Equipment</button>
                    <button class="option-btn" data-value="dumbbells">Dumbbells</button>
                    <button class="option-btn" data-value="bands">Resistance Bands</button>
                    <button class="option-btn" data-value="yoga">Yoga Mat</button>
                </div>
            </div>

            <div class="form-section" style="animation-delay: 0.4s">
                <h2 class="section-title">Primary Goals</h2>
                <div class="button-group" id="goalsGroup">
                    <button class="option-btn" data-value="fat-loss">Fat Loss</button>
                    <button class="option-btn" data-value="muscle">Muscle Gain</button>
                    <button class="option-btn" data-value="endurance">Endurance</button>
                    <button class="option-btn" data-value="flexibility">Flexibility</button>
                    <button class="option-btn" data-value="general">General Fitness</button>
                </div>
            </div>

            <button class="generate-btn" onclick="generatePlan()">Generate My Plan</button>
        </div>
    </div>

    <!-- Week Selection Page -->
    <div id="weekSelectionPage" class="page">
        <div class="container">
            <button class="back-btn" onclick="goToUserDetails()">‚Üê Back to Settings</button>
            
            <h1>Select Week</h1>
            <p class="subtitle" id="programSummary"></p>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalDays">0</div>
                    <div class="stat-label">Total Days</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="completedDays">0</div>
                    <div class="stat-label">Days Completed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="streakDays">0</div>
                    <div class="stat-label">Current Streak</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="percentComplete">0%</div>
                    <div class="stat-label">Progress</div>
                </div>
            </div>

            <div id="weekGrid" class="week-grid"></div>
        </div>
    </div>

    <!-- Day Selection Page -->
    <div id="daySelectionPage" class="page">
        <div class="container">
            <button class="back-btn" onclick="goToWeekSelection()">‚Üê Back to Weeks</button>
            
            <h1 id="weekTitle">Week 1</h1>
            <p class="subtitle">Select a day to view your workout and diet plan</p>

            <div id="dayGrid" class="week-grid"></div>
        </div>
    </div>

    <!-- Daily Plan Page -->
    <div id="planPage" class="page">
        <div class="container">
            <button class="back-btn" onclick="goToDaySelection()">‚Üê Back to Days</button>
            
            <h1 id="dayTitle">Day 1</h1>
            <p class="subtitle" id="userSummary"></p>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalExercises">0</div>
                    <div class="stat-label">Exercises</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalDuration">0</div>
                    <div class="stat-label">Minutes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="calorieTarget">0</div>
                    <div class="stat-label">Calories Target</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="proteinTarget">0g</div>
                    <div class="stat-label">Protein</div>
                </div>
            </div>

            <div class="tabs">
                <div class="tab active" onclick="switchTab('workout')">üí™ Workout</div>
                <div class="tab" onclick="switchTab('diet')">ü•ó Diet</div>
            </div>

            <div id="workoutTab" class="tab-content active">
                <div id="workoutList"></div>
            </div>

            <div id="dietTab" class="tab-content">
                <div id="dietList"></div>
            </div>

            <button class="complete-day-btn" onclick="completeDay()">‚úì Mark Day as Complete</button>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="profile-modal" id="profileModal">
        <div class="profile-content">
            <span class="close-btn" onclick="closeProfile()">√ó</span>
            <h2 style="font-family: 'Syne', sans-serif; margin-bottom: 2rem;">Your Progress</h2>
            
            <div class="progress-stat">
                <span class="progress-label">Total Days</span>
                <span class="progress-value" id="modalTotalDays">0</span>
            </div>
            
            <div class="progress-stat">
                <span class="progress-label">Days Completed</span>
                <span class="progress-value" id="modalCompletedDays">0</span>
            </div>
            
            <div class="progress-stat">
                <span class="progress-label">Current Streak</span>
                <span class="progress-value" id="modalStreak">0 üî•</span>
            </div>
            
            <div class="progress-stat">
                <span class="progress-label">Total Workouts</span>
                <span class="progress-value" id="modalWorkouts">0</span>
            </div>
            
            <div class="progress-stat">
                <span class="progress-label">Completion Rate</span>
                <span class="progress-value" id="modalCompletion">0%</span>
            </div>
            
            <div class="progress-stat">
                <span class="progress-label">Estimated Calories Burned</span>
                <span class="progress-value" id="modalCalories">0</span>
            </div>
            
            <div style="margin-top: 2rem;">
                <h3 style="margin-bottom: 1rem;">Weekly Progress</h3>
                <div id="weeklyProgress"></div>
            </div>
        </div>
    </div>

    <div class="break-overlay" id="breakOverlay">
        <div class="break-content">
            <h2 style="font-family: 'Syne', sans-serif; font-size: 3rem;">Break Time!</h2>
            <div class="break-timer" id="breakTimer">15</div>
            <p style="font-size: 1.2rem; color: var(--text-secondary);">Rest and prepare for your next exercise</p>
        </div>
    </div>

    <script>
        let userData = {
            age: 20,
            weight: 100,
            height: 188,
            duration: 60,
            programDays: 30,
            equipment: [],
            goals: [],
            startDate: new Date()
        };

        let progressData = {
            completedDays: [],
            currentStreak: 0,
            totalWorkouts: 0
        };

        let currentWeek = 1;
        let currentDay = 1;
        let currentTimers = {};
        let breakInterval = null;
        let completedExercises = 0;

        // Load progress from localStorage
        function loadProgress() {
            const saved = localStorage.getItem('healthPlannerProgress');
            if (saved) {
                progressData = JSON.parse(saved);
            }
        }

        // Save progress to localStorage
        function saveProgress() {
            localStorage.setItem('healthPlannerProgress', JSON.stringify(progressData));
        }

        // Option button handlers
        document.querySelectorAll('.option-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const parent = this.parentElement;
                const isMultiSelect = parent.id === 'equipmentGroup' || parent.id === 'goalsGroup';
                
                if (isMultiSelect) {
                    this.classList.toggle('active');
                } else {
                    parent.querySelectorAll('.option-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    if (parent.id === 'durationGroup') {
                        userData.duration = parseInt(this.dataset.value);
                    } else if (parent.id === 'programDurationGroup') {
                        userData.programDays = parseInt(this.dataset.value);
                    }
                }
            });
        });

        function generatePlan() {
            userData.age = parseInt(document.getElementById('age').value) || 20;
            userData.weight = parseInt(document.getElementById('weight').value) || 100;
            userData.height = parseInt(document.getElementById('height').value) || 188;
            
            userData.equipment = Array.from(document.querySelectorAll('#equipmentGroup .option-btn.active'))
                .map(btn => btn.dataset.value);
            
            userData.goals = Array.from(document.querySelectorAll('#goalsGroup .option-btn.active'))
                .map(btn => btn.dataset.value);

            if (userData.goals.length === 0) {
                userData.goals = ['general'];
            }

            userData.startDate = new Date();
            
            loadProgress();
            
            document.getElementById('userDetailsPage').classList.remove('active');
            document.getElementById('weekSelectionPage').classList.add('active');
            document.getElementById('profileBtn').style.display = 'flex';
            
            generateWeekGrid();
            updateProgressStats();
        }

        function generateWeekGrid() {
            const totalWeeks = Math.ceil(userData.programDays / 7);
            const weekGrid = document.getElementById('weekGrid');
            weekGrid.innerHTML = '';
            
            const programText = userData.programDays === 7 ? '1 Week' : 
                               userData.programDays === 30 ? '1 Month' :
                               userData.programDays === 90 ? '3 Months' : '6 Months';
            document.getElementById('programSummary').textContent = 
                `${programText} Program - ${totalWeeks} weeks of transformation`;
            
            for (let i = 1; i <= totalWeeks; i++) {
                const weekBtn = document.createElement('div');
                weekBtn.className = 'week-btn';
                const weekStart = (i - 1) * 7 + 1;
                const weekEnd = Math.min(i * 7, userData.programDays);
                const daysInWeek = weekEnd - weekStart + 1;
                
                const completedInWeek = progressData.completedDays.filter(d => 
                    d >= weekStart && d <= weekEnd
                ).length;
                
                if (completedInWeek === daysInWeek) {
                    weekBtn.classList.add('completed');
                }
                
                weekBtn.innerHTML = `
                    <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üìÖ</div>
                    <div>Week ${i}</div>
                    <div style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.5rem;">
                        ${completedInWeek}/${daysInWeek} days
                    </div>
                `;
                weekBtn.onclick = () => showWeek(i);
                weekGrid.appendChild(weekBtn);
            }
        }

        function showWeek(week) {
            currentWeek = week;
            document.getElementById('weekSelectionPage').classList.remove('active');
            document.getElementById('daySelectionPage').classList.add('active');
            
            document.getElementById('weekTitle').textContent = `Week ${week}`;
            
            const dayGrid = document.getElementById('dayGrid');
            dayGrid.innerHTML = '';
            
            const weekStart = (week - 1) * 7 + 1;
            const weekEnd = Math.min(week * 7, userData.programDays);
            
            for (let i = weekStart; i <= weekEnd; i++) {
                const dayBtn = document.createElement('div');
                dayBtn.className = 'day-btn';
                
                if (progressData.completedDays.includes(i)) {
                    dayBtn.classList.add('completed');
                }
                
                dayBtn.innerHTML = `
                    <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">
                        ${getDayEmoji(i)}
                    </div>
                    <div>Day ${i}</div>
                    <div style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.5rem;">
                        ${getDayLabel(i)}
                    </div>
                `;
                dayBtn.onclick = () => showDay(i);
                dayGrid.appendChild(dayBtn);
            }
        }

        function getDayEmoji(day) {
            const emojis = ['üí™', 'üî•', '‚ö°', 'üéØ', 'üíØ', 'üöÄ', '‚≠ê'];
            return emojis[(day - 1) % 7];
        }

        function getDayLabel(day) {
            if (progressData.completedDays.includes(day)) {
                return 'Completed ‚úì';
            }
            const today = Math.floor((new Date() - userData.startDate) / (1000 * 60 * 60 * 24)) + 1;
            if (day === today) {
                return 'Today';
            } else if (day < today) {
                return 'Missed';
            } else {
                return 'Upcoming';
            }
        }

        function showDay(day) {
            currentDay = day;
            document.getElementById('daySelectionPage').classList.remove('active');
            document.getElementById('planPage').classList.add('active');
            
            document.getElementById('dayTitle').textContent = `Day ${day} - Week ${currentWeek}`;
            
            generateWorkoutPlan(day);
            generateDietPlan(day);
            updateStats();
        }

        function generateWorkoutPlan(day) {
            const exercises = getExercises(day);
            const workoutList = document.getElementById('workoutList');
            workoutList.innerHTML = '';
            
            exercises.forEach((exercise, index) => {
                const card = document.createElement('div');
                card.className = 'workout-card';
                card.style.animationDelay = `${index * 0.1}s`;
                card.innerHTML = `
                    <div class="exercise-header">
                        <div class="exercise-name">${exercise.name}</div>
                        <div class="exercise-duration">${exercise.duration}</div>
                    </div>
                    <div class="exercise-details">${exercise.description}</div>
                    <div class="timer-display" id="timer-${index}">
                        ${exercise.duration}
                    </div>
                    <div class="timer-controls">
                        <button class="timer-btn" onclick="startTimer(${index}, '${exercise.duration}')">Start</button>
                        <button class="timer-btn" onclick="pauseTimer(${index})">Pause</button>
                        <button class="timer-btn" onclick="resetTimer(${index}, '${exercise.duration}')">Reset</button>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-${index}" style="width: 0%"></div>
                    </div>
                `;
                workoutList.appendChild(card);
            });
        }

        function getExercises(day) {
            const hasEquipment = userData.equipment.length > 0 && !userData.equipment.includes('none');
            const duration = userData.duration * 60;
            const goals = userData.goals;
            const dayMod = day % 7;
            
            let allExercises = [];
            
            // Warmup
            allExercises.push(
                { name: 'Jumping Jacks', duration: '2:00', seconds: 120, description: 'Full body cardio warm-up', type: 'warmup' },
                { name: 'Arm Circles', duration: '1:00', seconds: 60, description: 'Shoulder mobility', type: 'warmup' },
                { name: 'Dynamic Stretches', duration: '2:00', seconds: 120, description: 'Prepare muscles', type: 'warmup' }
            );
            
            // Vary exercises based on day of week
            if (dayMod === 1 || dayMod === 4) { // Upper body focus
                if (hasEquipment && userData.equipment.includes('dumbbells')) {
                    allExercises.push(
                        { name: 'Dumbbell Chest Press', duration: '3:00', seconds: 180, description: '4 sets of 10 reps', type: 'strength' },
                        { name: 'Dumbbell Rows', duration: '3:00', seconds: 180, description: '4 sets of 12 reps', type: 'strength' },
                        { name: 'Dumbbell Shoulder Press', duration: '2:30', seconds: 150, description: '3 sets of 10 reps', type: 'strength' },
                        { name: 'Dumbbell Bicep Curls', duration: '2:00', seconds: 120, description: '3 sets of 15 reps', type: 'strength' },
                        { name: 'Dumbbell Tricep Extensions', duration: '2:00', seconds: 120, description: '3 sets of 12 reps', type: 'strength' }
                    );
                } else {
                    allExercises.push(
                        { name: 'Push-ups', duration: '2:30', seconds: 150, description: '4 sets to failure', type: 'strength' },
                        { name: 'Pike Push-ups', duration: '2:00', seconds: 120, description: '3 sets of 12 reps', type: 'strength' },
                        { name: 'Tricep Dips', duration: '2:00', seconds: 120, description: '3 sets of 15 reps', type: 'strength' },
                        { name: 'Diamond Push-ups', duration: '2:00', seconds: 120, description: '3 sets of 10 reps', type: 'strength' }
                    );
                }
            } else if (dayMod === 2 || dayMod === 5) { // Lower body focus
                if (hasEquipment && userData.equipment.includes('dumbbells')) {
                    allExercises.push(
                        { name: 'Dumbbell Squats', duration: '3:00', seconds: 180, description: '4 sets of 12 reps', type: 'strength' },
                        { name: 'Dumbbell Lunges', duration: '3:00', seconds: 180, description: '3 sets of 10 each leg', type: 'strength' },
                        { name: 'Dumbbell Deadlifts', duration: '3:00', seconds: 180, description: '4 sets of 10 reps', type: 'strength' },
                        { name: 'Dumbbell Calf Raises', duration: '2:00', seconds: 120, description: '3 sets of 20 reps', type: 'strength' }
                    );
                } else {
                    allExercises.push(
                        { name: 'Bodyweight Squats', duration: '3:00', seconds: 180, description: '4 sets of 20 reps', type: 'strength' },
                        { name: 'Lunges', duration: '3:00', seconds: 180, description: '3 sets of 15 each leg', type: 'strength' },
                        { name: 'Jump Squats', duration: '2:00', seconds: 120, description: 'Explosive leg power', type: 'cardio' },
                        { name: 'Glute Bridges', duration: '2:00', seconds: 120, description: '3 sets of 15 reps', type: 'strength' }
                    );
                }
            } else if (dayMod === 3 || dayMod === 6) { // Cardio focus
                allExercises.push(
                    { name: 'High Knees', duration: '2:00', seconds: 120, description: 'Cardiovascular endurance', type: 'cardio' },
                    { name: 'Mountain Climbers', duration: '2:00', seconds: 120, description: 'Core and cardio', type: 'cardio' },
                    { name: 'Burpees', duration: '2:30', seconds: 150, description: 'Full body HIIT', type: 'cardio' },
                    { name: 'Skater Hops', duration: '2:00', seconds: 120, description: 'Lateral movement', type: 'cardio' },
                    { name: 'Jump Rope (or simulate)', duration: '3:00', seconds: 180, description: 'Cardio conditioning', type: 'cardio' }
                );
            } else { // Rest/flexibility day
                allExercises.push(
                    { name: 'Yoga Flow', duration: '4:00', seconds: 240, description: 'Sun salutations', type: 'flexibility' },
                    { name: 'Hip Openers', duration: '3:00', seconds: 180, description: 'Pigeon pose variations', type: 'flexibility' },
                    { name: 'Hamstring Stretches', duration: '2:00', seconds: 120, description: 'Forward folds', type: 'flexibility' }
                );
            }
            
            // Core exercises (added to most days)
            if (dayMod !== 0) {
                allExercises.push(
                    { name: 'Plank Hold', duration: '2:00', seconds: 120, description: '4 sets of 30 seconds', type: 'core' },
                    { name: 'Russian Twists', duration: '2:00', seconds: 120, description: '3 sets of 20 reps', type: 'core' },
                    { name: 'Bicycle Crunches', duration: '2:00', seconds: 120, description: '3 sets of 20 reps', type: 'core' },
                    { name: 'Leg Raises', duration: '2:00', seconds: 120, description: '3 sets of 15 reps', type: 'core' }
                );
            }
            
            // Cooldown
            allExercises.push(
                { name: 'Walking Recovery', duration: '2:00', seconds: 120, description: 'Lower heart rate', type: 'cooldown' },
                { name: 'Full Body Stretch', duration: '3:00', seconds: 180, description: 'Hold each stretch', type: 'cooldown' },
                { name: 'Deep Breathing', duration: '2:00', seconds: 120, description: 'Relaxation', type: 'cooldown' }
            );
            
            // Select exercises to match duration
            let selectedExercises = [];
            let currentDuration = 0;
            let breakTime = 0;
            
            // Warmup
            let warmups = allExercises.filter(ex => ex.type === 'warmup');
            for (let ex of warmups) {
                if (currentDuration + ex.seconds <= duration - 300) {
                    selectedExercises.push(ex);
                    currentDuration += ex.seconds;
                    breakTime += 15;
                }
            }
            
            // Main exercises
            let mainExercises = allExercises.filter(ex => ex.type !== 'warmup' && ex.type !== 'cooldown');
            mainExercises.sort(() => Math.random() - 0.5);
            
            for (let ex of mainExercises) {
                if (currentDuration + ex.seconds + breakTime + 300 <= duration) {
                    selectedExercises.push(ex);
                    currentDuration += ex.seconds;
                    breakTime += 15;
                }
            }
            
            // Cooldown
            let cooldowns = allExercises.filter(ex => ex.type === 'cooldown');
            for (let ex of cooldowns) {
                if (currentDuration + ex.seconds + breakTime <= duration) {
                    selectedExercises.push(ex);
                    currentDuration += ex.seconds;
                }
            }
            
            return selectedExercises;
        }

        function generateDietPlan(day) {
            const bmr = 10 * userData.weight + 6.25 * userData.height - 5 * userData.age + 5;
            const calories = Math.round(bmr * 1.5);
            const protein = Math.round(userData.weight * 2);
            
            const dietList = document.getElementById('dietList');
            dietList.innerHTML = '';
            
            // Vary meals slightly based on day
            const dayMod = day % 3;
            const proteinSource = dayMod === 0 ? 'Grilled chicken breast (200g)' : 
                                 dayMod === 1 ? 'Grilled fish (200g)' : 
                                 'Paneer/Tofu (200g)';
            
            const meals = [
                {
                    time: 'Breakfast (8:00 AM)',
                    name: 'Protein-Packed Start',
                    items: [
                        '4 Egg whites + 2 whole eggs',
                        '2 slices whole grain toast',
                        '1 banana',
                        'Green tea'
                    ],
                    calories: Math.round(calories * 0.25),
                    protein: Math.round(protein * 0.25),
                    carbs: '45g',
                    fats: '12g'
                },
                {
                    time: 'Mid-Morning (11:00 AM)',
                    name: 'Energy Booster',
                    items: [
                        'Greek yogurt (200g)',
                        'Mixed berries',
                        '30g almonds'
                    ],
                    calories: Math.round(calories * 0.15),
                    protein: Math.round(protein * 0.2),
                    carbs: '28g',
                    fats: '15g'
                },
                {
                    time: 'Lunch (1:30 PM)',
                    name: 'Power Lunch',
                    items: [
                        proteinSource,
                        'Brown rice (150g)',
                        'Mixed vegetables',
                        'Olive oil dressing'
                    ],
                    calories: Math.round(calories * 0.35),
                    protein: Math.round(protein * 0.35),
                    carbs: '55g',
                    fats: '18g'
                },
                {
                    time: 'Pre-Workout (4:00 PM)',
                    name: 'Fuel Up',
                    items: [
                        'Banana',
                        'Handful of dates',
                        'Black coffee'
                    ],
                    calories: Math.round(calories * 0.1),
                    protein: Math.round(protein * 0.05),
                    carbs: '35g',
                    fats: '2g'
                },
                {
                    time: 'Dinner (7:30 PM)',
                    name: 'Recovery Meal',
                    items: [
                        proteinSource,
                        'Quinoa (100g)',
                        'Large salad',
                        'Avocado'
                    ],
                    calories: Math.round(calories * 0.15),
                    protein: Math.round(protein * 0.15),
                    carbs: '35g',
                    fats: '20g'
                }
            ];
            
            meals.forEach((meal, index) => {
                const card = document.createElement('div');
                card.className = 'meal-card';
                card.style.animationDelay = `${index * 0.1}s`;
                card.innerHTML = `
                    <div class="meal-time">${meal.time}</div>
                    <div class="meal-name">${meal.name}</div>
                    <div class="meal-items">
                        ${meal.items.map(item => `<div class="meal-item">${item}</div>`).join('')}
                    </div>
                    <div class="nutrition-info">
                        <div class="nutrition-item">
                            <span class="nutrition-label">Calories</span>
                            <span class="nutrition-value">${meal.calories}</span>
                        </div>
                        <div class="nutrition-item">
                            <span class="nutrition-label">Protein</span>
                            <span class="nutrition-value">${meal.protein}g</span>
                        </div>
                        <div class="nutrition-item">
                            <span class="nutrition-label">Carbs</span>
                            <span class="nutrition-value">${meal.carbs}</span>
                        </div>
                        <div class="nutrition-item">
                            <span class="nutrition-label">Fats</span>
                            <span class="nutrition-value">${meal.fats}</span>
                        </div>
                    </div>
                `;
                dietList.appendChild(card);
            });
        }

        function updateStats() {
            const exercises = getExercises(currentDay);
            const totalMinutes = exercises.reduce((sum, ex) => sum + ex.seconds, 0) / 60;
            
            const bmr = 10 * userData.weight + 6.25 * userData.height - 5 * userData.age + 5;
            const calories = Math.round(bmr * 1.5);
            const protein = Math.round(userData.weight * 2);
            
            document.getElementById('totalExercises').textContent = exercises.length;
            document.getElementById('totalDuration').textContent = Math.round(totalMinutes);
            document.getElementById('calorieTarget').textContent = calories;
            document.getElementById('proteinTarget').textContent = protein + 'g';
            
            const bmi = (userData.weight / ((userData.height/100) ** 2)).toFixed(1);
            document.getElementById('userSummary').textContent = 
                `Age: ${userData.age} | Weight: ${userData.weight}kg | Height: ${userData.height}cm | BMI: ${bmi}`;
        }

        function updateProgressStats() {
            document.getElementById('totalDays').textContent = userData.programDays;
            document.getElementById('completedDays').textContent = progressData.completedDays.length;
            document.getElementById('streakDays').textContent = calculateStreak();
            
            const percentComplete = Math.round((progressData.completedDays.length / userData.programDays) * 100);
            document.getElementById('percentComplete').textContent = percentComplete + '%';
        }

        function calculateStreak() {
            if (progressData.completedDays.length === 0) return 0;
            
            const sortedDays = [...progressData.completedDays].sort((a, b) => b - a);
            let streak = 1;
            
            for (let i = 0; i < sortedDays.length - 1; i++) {
                if (sortedDays[i] - sortedDays[i + 1] === 1) {
                    streak++;
                } else {
                    break;
                }
            }
            
            return streak;
        }

        function completeDay() {
            if (!progressData.completedDays.includes(currentDay)) {
                progressData.completedDays.push(currentDay);
                progressData.totalWorkouts += getExercises(currentDay).length;
                saveProgress();
                
                alert('üéâ Congratulations! Day ' + currentDay + ' completed!');
                
                goToDaySelection();
            } else {
                alert('This day is already marked as complete!');
            }
        }

        function showProfile() {
            document.getElementById('profileModal').classList.add('active');
            
            document.getElementById('modalTotalDays').textContent = userData.programDays;
            document.getElementById('modalCompletedDays').textContent = progressData.completedDays.length;
            document.getElementById('modalStreak').textContent = calculateStreak() + ' üî•';
            document.getElementById('modalWorkouts').textContent = progressData.totalWorkouts;
            
            const completion = Math.round((progressData.completedDays.length / userData.programDays) * 100);
            document.getElementById('modalCompletion').textContent = completion + '%';
            
            const caloriesPerWorkout = userData.duration * 5;
            document.getElementById('modalCalories').textContent = 
                (progressData.completedDays.length * caloriesPerWorkout).toLocaleString();
            
            // Weekly progress
            const weeklyProgress = document.getElementById('weeklyProgress');
            weeklyProgress.innerHTML = '';
            const totalWeeks = Math.ceil(userData.programDays / 7);
            
            for (let i = 1; i <= totalWeeks; i++) {
                const weekStart = (i - 1) * 7 + 1;
                const weekEnd = Math.min(i * 7, userData.programDays);
                const completedInWeek = progressData.completedDays.filter(d => 
                    d >= weekStart && d <= weekEnd
                ).length;
                const totalDaysInWeek = weekEnd - weekStart + 1;
                
                const weekBar = document.createElement('div');
                weekBar.style.cssText = 'margin-bottom: 1rem;';
                weekBar.innerHTML = `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>Week ${i}</span>
                        <span style="color: var(--primary);">${completedInWeek}/${totalDaysInWeek}</span>
                    </div>
                    <div style="width: 100%; height: 10px; background: var(--bg-dark); border-radius: 10px; overflow: hidden;">
                        <div style="width: ${(completedInWeek/totalDaysInWeek)*100}%; height: 100%; background: var(--primary); border-radius: 10px;"></div>
                    </div>
                `;
                weeklyProgress.appendChild(weekBar);
            }
        }

        function closeProfile() {
            document.getElementById('profileModal').classList.remove('active');
        }

        function startTimer(index, durationStr) {
            if (currentTimers[index]) {
                clearInterval(currentTimers[index].interval);
            }
            
            const exercises = getExercises(currentDay);
            const totalSeconds = exercises[index].seconds;
            let remainingSeconds = currentTimers[index]?.remaining || totalSeconds;
            
            currentTimers[index] = {
                interval: setInterval(() => {
                    remainingSeconds--;
                    
                    const minutes = Math.floor(remainingSeconds / 60);
                    const seconds = remainingSeconds % 60;
                    document.getElementById(`timer-${index}`).textContent = 
                        `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    
                    const progress = ((totalSeconds - remainingSeconds) / totalSeconds) * 100;
                    document.getElementById(`progress-${index}`).style.width = progress + '%';
                    
                    if (remainingSeconds <= 0) {
                        clearInterval(currentTimers[index].interval);
                        delete currentTimers[index];
                        document.getElementById(`timer-${index}`).textContent = 'Complete!';
                        document.getElementById(`progress-${index}`).style.width = '100%';
                        
                        completedExercises++;
                        if (completedExercises < exercises.length) {
                            showBreak();
                        }
                    }
                }, 1000),
                remaining: remainingSeconds
            };
        }

        function pauseTimer(index) {
            if (currentTimers[index]) {
                clearInterval(currentTimers[index].interval);
            }
        }

        function resetTimer(index, durationStr) {
            if (currentTimers[index]) {
                clearInterval(currentTimers[index].interval);
                delete currentTimers[index];
            }
            document.getElementById(`timer-${index}`).textContent = durationStr;
            document.getElementById(`progress-${index}`).style.width = '0%';
        }

        function showBreak() {
            const overlay = document.getElementById('breakOverlay');
            overlay.classList.add('active');
            
            let breakTime = 15;
            document.getElementById('breakTimer').textContent = breakTime;
            
            breakInterval = setInterval(() => {
                breakTime--;
                document.getElementById('breakTimer').textContent = breakTime;
                
                if (breakTime <= 0) {
                    clearInterval(breakInterval);
                    overlay.classList.remove('active');
                }
            }, 1000);
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            if (tab === 'workout') {
                document.querySelector('.tab:nth-child(1)').classList.add('active');
                document.getElementById('workoutTab').classList.add('active');
            } else {
                document.querySelector('.tab:nth-child(2)').classList.add('active');
                document.getElementById('dietTab').classList.add('active');
            }
        }

        function goToUserDetails() {
            document.getElementById('weekSelectionPage').classList.remove('active');
            document.getElementById('userDetailsPage').classList.add('active');
            document.getElementById('profileBtn').style.display = 'none';
        }

        function goToWeekSelection() {
            document.getElementById('daySelectionPage').classList.remove('active');
            document.getElementById('weekSelectionPage').classList.add('active');
            generateWeekGrid();
            updateProgressStats();
        }

        function goToDaySelection() {
            document.getElementById('planPage').classList.remove('active');
            document.getElementById('daySelectionPage').classList.add('active');
            
            Object.values(currentTimers).forEach(timer => {
                if (timer.interval) clearInterval(timer.interval);
            });
            currentTimers = {};
            completedExercises = 0;
            
            if (breakInterval) {
                clearInterval(breakInterval);
                document.getElementById('breakOverlay').classList.remove('active');
            }
            
            showWeek(currentWeek);
        }

        // Load progress on page load
        loadProgress();
    </script>
</body>
</html>
